<app-sidebar></app-sidebar>
<div class="container-fluid ps-6">
  <app-dashboard-head></app-dashboard-head>
  <div class="main-container">
    <div>
      <h3>Product & Services</h3>
    </div>
    <div class="card text-nowrap">
      <p-table
        #dt1
        [value]="productList"
        dataKey="id"
        [globalFilterFields]="['name']"
      >
        <ng-template pTemplate="caption">
          <div class="flex clearfix">

            <span class="p-input-icon-right ml-auto d-none">
              <i class="pi pi-search"></i>
              <input
                pInputText
                type="text"
                (input)="searchProduct($event.target)"
                placeholder="Search Product"
              />
            </span>

            <button
              pButton
              label="Add"
              class="p-button-dark bg-dark float-end"
              (click)="show()"
              icon="pi pi-plus"
            ></button>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th class="col">
              <div class="d-flex justify-content-center">Name</div>
            </th>
            <th class="col">
              <div class="d-flex justify-content-center">Category</div>
            </th>
            <th class="col">
              <div class="d-flex justify-content-center">Sub Category</div>
            </th>
            <th class="col">
              <div class="d-flex justify-content-center">Type</div>
            </th>
            <th class="col">
              <div class="d-flex justify-content-center">Description</div>
            </th>
            <th class="col">
              <div class="d-flex justify-content-center">Cost</div>
            </th>
            <th class="col">
              <div class="d-flex justify-content-center">Action</div>
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-vendor let-i="rowIndex">
          <tr>
            <td class="text-center">
              {{ vendor?.name }}
            </td>
            <td class="text-center">
              {{ vendor?.productCategory.name }}
            </td>
            <td class="text-center">
              <span *ngIf="vendor?.productCategory?.parentProductCategory?.name">
                {{ vendor?.productCategory?.parentProductCategory?.name }}
              </span>
            </td>
            <td class="text-center">
              {{ vendor?.type }}
            </td>
            <td class="text-center">
              {{ vendor?.description }}
            </td>
            <td class="text-center">
              {{ vendor?.cost }}
            </td>
            <td class="text-center">
              <div
                class="btn-group mr-2"
                role="group"
                aria-label="Second group"
              >
                <button
                  type="button"
                  class="btn order-table-btn"
                  (click)="editProduct(vendor)"
                >
                  <i class="fa-solid fa-pen"></i>&nbsp;Edit
                </button>
                <button
                  type="button"
                  class="btn order-table-btn"
                  (click)="deleteProduct(vendor)"
                >
                  <i class="fa-solid fa-trash"></i>&nbsp;Delete
                </button>
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="7" class="text-center">No Product Is Found</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>
<p-toast></p-toast>
<p-dialog
  header="Category Information"
  [(visible)]="visible"
  [breakpoints]="{ '960px': '75vw' }"
  [style]="{ width: '30vw' }"
  [draggable]="false"
  [resizable]="false"
>
  <div class="main-container">
    <div class="order-body py-2">
      <form class="was-validated" novalidate #addFrom="ngForm" (ngSubmit)="submit()">
        <div class="row mx-auto">
          <div class="col-12 my-3">
            <label class="add-order-label m-0">Name</label>
            <input
              type="text"
              class="order-search form-control order-form-input m-0"
              style="border: 1px solid #ced4da"
              [(ngModel)]="productService.name"
              placeholder="Enter Name"
              name="name"
              required
            />
          </div>

          <div class="col-12 my-3">
            <label class="add-order-label m-0 mb-1">Category</label>
            <p-dropdown
              [options]="categories"
              styleClass="w-100"
              optionLabel="name"
              optionValue="id"
              placeholder="Select Category"
              [(ngModel)]="productService.productCategory.id"
              [filter]="true"
              filterBy="name"
              (onChange)="getSubCategories($event.value)"
              [showClear]="true"
              name="category"
              #categoryModel="ngModel"
              [required]="true"
              [ngClass]="{
                'ng-dirty ng-invalid':
                  categoryModel.invalid &&
                  (categoryModel.dirty || categoryModel.touched)
              }"
            >
            </p-dropdown>
            <div
              *ngIf="
                categoryModel.invalid &&
                (categoryModel.dirty || categoryModel.touched)
              "
            >
              <div *ngIf="categoryModel.errors" class="text-danger m-1">
                Category is required.
              </div>
            </div>
          </div>
          <div class="col-12 my-3" *ngIf="subCategory?.parentProductCategory">
            <label class="add-order-label m-0 mb-1">Sub Category</label>
            <p-dropdown
              [options]="[subCategory?.parentProductCategory]"
              styleClass="w-100"
              optionLabel="name"
              optionValue="id"
              placeholder="Select Sub Category"
              [(ngModel)]="productService.productCategory.parentProductCategory!.id"
              [filter]="true"
              filterBy="name"
              [showClear]="true"
              name="subCategory"
              #subCategoryModel="ngModel"
              [required]="true"
              [ngClass]="{
                'ng-dirty ng-invalid':
                  subCategoryModel.invalid &&
                  (subCategoryModel.dirty || subCategoryModel.touched)
              }"
            >
            </p-dropdown>
            <div
              *ngIf="
                subCategoryModel.invalid &&
                (subCategoryModel.dirty || subCategoryModel.touched)
              "
            >
              <div *ngIf="subCategoryModel.errors" class="text-danger m-1">
                Sub Category is required.
              </div>
            </div>
          </div>
          <div class="col-12 my-3">
            <label class="add-order-label m-0 mb-1">Type</label>
            <p-dropdown
              [options]="productTypes?.productFieldValuesList"
              styleClass="w-100"
              optionLabel="name"
              optionValue="name"
              placeholder="Select Type"
              [(ngModel)]="productService.type"
              [filter]="true"
              filterBy="name"
              [showClear]="true"
              name="type"
              #typeModel="ngModel"
              [required]="true"
              [ngClass]="{
                'ng-dirty ng-invalid':
                  typeModel.invalid && (typeModel.dirty || typeModel.touched)
              }"
            >
            </p-dropdown>
            <div
              *ngIf="
                typeModel.invalid && (typeModel.dirty || typeModel.touched)
              "
            >
              <div *ngIf="typeModel.errors" class="text-danger m-1">
                Type is required.
              </div>
            </div>
          </div>

          <div class="col-12 my-3">
            <label class="add-order-label m-0">Description</label>
            <textarea
              name="desc"
              id="desc"
              cols="40"
              rows="10"
              [(ngModel)]="productService.description"
            ></textarea>
          </div>
          <div class="col-6 my-3 p-fluid">
            <label class="add-order-label d-inline-block m-0 mb-1"
              >Cost</label
            >
            <div class="flex-auto">
              <p-inputNumber
                [(ngModel)]="productService.cost"
                inputId="minmax"
                [min]="0"
                [max]="10000"
                [format]="true"
                mode="currency"
                currency="PKR"
                name="cost"
                #rateModel="ngModel"
                [required]="true"
              >
              </p-inputNumber>
              <div
                *ngIf="
                  rateModel.invalid && (rateModel.dirty || rateModel.touched)
                "
              >
                <div *ngIf="rateModel.errors" class="text-danger m-1">
                  Cost is required.
                </div>
              </div>
            </div>
          </div>
          <div class="col-6 d-flex align-items-end justify-content-end mb-3">
            <button
              type="submit"
              class="btn btn-dark"
              [disabled]="!addFrom.valid"
            >
              {{mode}}
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</p-dialog>
